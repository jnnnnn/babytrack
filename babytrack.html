<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Baby Log</title>
  <script src="https://unpkg.com/d3@7"></script>
  <script src="sync-client.js"></script>
  <script src="babytrack.js" defer></script>
  <script src="reporting.js" defer></script>
  <link rel="stylesheet" href="babytrack.css" />
</head>

<body>
  <div class="container">
    <div class="header-row">
      <h2>Baby Daily Log</h2>
      <div style="display: flex; gap: 4px;">
        <button class="settings-btn" onclick="openSyncModal()" title="Sync">üîÑ</button>
        <button class="settings-btn" onclick="openConfigModal()" title="Settings">‚öôÔ∏è</button>
      </div>
    </div>

    <!-- Buttons will be dynamically generated here -->

    <div class="card">
      <input type="text" id="notes" placeholder="Notes - type and press Enter" />
      <small id="laststamp" class="timestamp">Not yet saved</small>
    </div>

    <div style="display: flex; gap: 8px">
      <div style="flex: 1"></div>
    </div>

    <div id="daily-report">
      <h3>Daily Report</h3>

      <div id="date-selector">
        <button onclick="changeReportDate(-1)">‚óÄ Prev</button>
        <input type="date" id="report-date" onchange="setReportDate(this.value)" />
        <button onclick="changeReportDate(1)">Next ‚ñ∂</button>
        <button onclick="goToToday()">Today</button>
      </div>

      <div class="tab-container">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="log" onclick="switchTab('log')">Event Log</button>
          <button class="tab-btn" data-tab="graphs" onclick="switchTab('graphs')">Graphs & Stats</button>
        </div>

        <div class="tabs-wrapper">
          <div id="log-tab" class="tab-content active">
            <div class="recent-events">
              <h4>Events</h4>

              <div class="event-list" id="recent-events-list">
                <!-- Will be populated by JS -->
              </div>

              <div style="display: flex; gap: 8px; align-items: center; margin-top: 12px; flex-wrap: wrap">
                <input type="text" id="event-filter" placeholder="Filter events..." style="
                      flex: 1;
                      min-width: 100px;
                      padding: 6px 10px;
                      font-size: 12px;
                      border-radius: 4px;
                      border: 1px solid var(--border);
                      background: var(--card);
                      color: var(--text);
                    " />
                <select id="event-type-filter" style="
                      padding: 6px;
                      font-size: 12px;
                      border-radius: 4px;
                      border: 1px solid var(--border);
                      background: var(--card);
                      color: var(--text);
                    ">
                  <option value="">All Types</option>
                  <option value="feed">Feed</option>
                  <option value="sleep">Sleep</option>
                  <option value="nappy">Nappy</option>
                  <option value="soothe">Soothe</option>
                  <option value="5s">5 S's</option>
                  <option value="note">Notes</option>
                </select>
                <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; white-space: nowrap">
                  <input type="checkbox" id="hide-deleted-filter" checked />
                  Hide deleted
                </label>
                <button class="btn" id="download" onclick="downloadCSV()" style="margin: 0">CSV</button>
                <button class="btn" onclick="downloadHourlyReport()"
                  style="margin: 0; background: #2196f3">Hourly</button>
                <button class="btn" onclick="importCSV()" style="margin: 0; background: #ff9800">Import</button>
              </div>
            </div>
          </div>

          <div id="graphs-tab" class="tab-content">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="label">Total Sleep</div>
                <div class="value" id="stat-sleep">0h 0m</div>
              </div>
              <!-- Dynamic stat cards added by JS based on config -->
            </div>

            <h4 style="font-size: 14px; margin: 16px 0 8px 0; color: var(--text-muted)">Hourly Activity</h4>
            <div class="hourly-grid" id="hourly-grid">
              <!-- Will be populated by JS -->
            </div>

            <div id="timeline-chart"></div>

            <div class="sleep-attempts">
              <h4>Sleep Attempts</h4>
              <div class="attempt-list" id="sleep-attempts-list">
                <!-- Will be populated by JS -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="time-picker-modal" class="modal-overlay" onclick="if(event.target === this) hideTimePicker()">
    <div class="modal">
      <h3>Select Time</h3>
      <input type="datetime-local" id="custom-time" />
      <div class="modal-buttons">
        <button class="cancel" onclick="hideTimePicker()">Cancel</button>
        <button class="confirm" onclick="saveWithCustomTime()">Save</button>
      </div>
    </div>
  </div>

  <div id="config-modal" class="modal-overlay" onclick="if(event.target === this) closeConfigModal()">
    <div class="modal">
      <h3>Customize Buttons</h3>
      <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px">
        Add, remove, or reorder buttons. Each group has a category (for grouping events) and buttons with emoji and label.
      </p>
      <div id="config-groups"></div>
      <div class="config-actions">
        <button class="reset-btn" onclick="resetConfig()">Reset to Default</button>
        <button class="cancel-btn" onclick="closeConfigModal()">Cancel</button>
        <button class="save-btn" onclick="saveConfig()">Save</button>
      </div>
    </div>
  </div>
</body>

</html>
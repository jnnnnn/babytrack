#!/bin/bash
set -euo pipefail

cd "$(dirname "$0")"

HUMAN_MODE=false
if [[ "${1:-}" == "--human" ]]; then
  HUMAN_MODE=true
fi

echo "=== Format ==="
gofmt -w server/

echo "=== Lint ==="
# TODO: golangci-lint run ./server/...

echo "=== Test ==="
(cd server && go test -cover ./...)

echo "=== E2E ==="
rm -f server/babytrack.db  # Clean DB for reproducible tests

if $HUMAN_MODE; then
  echo "(Human mode: headed browser, slowMo 500ms)"
  npx playwright test --headed --project=chromium
else
  npx playwright test
fi

echo ""
echo "âœ“ All checks passed"
